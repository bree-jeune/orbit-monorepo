const CACHE_NAME="orbit-v2",STATIC_ASSETS=["/","/index.html","/bundle.js","/sounds/Space Ambience.mp3","/sounds/17640 futuristic prompt-full.mp3","/sounds/Futuristic Reveal.wav","/sounds/Futuristic Feature Select.mp3","/sounds/Futuristic Power Generation.wav"];async function cacheFirst(e){const t=await caches.match(e);if(t)return t;try{const t=await fetch(e);return t.ok&&(await caches.open("orbit-v2")).put(e,t.clone()),t}catch(e){return console.error("[SW] Cache-first fetch failed:",e),new Response("Offline",{status:503})}}async function staleWhileRevalidate(e){const t=await caches.open("orbit-v2"),n=await t.match(e),i=fetch(e).then(n=>(n.ok&&t.put(e,n.clone()),n)).catch(e=>(console.error("[SW] Network request failed:",e),null));if(n)return n;return await i||new Response("Offline",{status:503})}function isStaticAsset(e){return"/manifest.json"!==e&&([".js",".css",".html",".png",".jpg",".svg",".mp3",".wav"].some(t=>e.endsWith(t))||"/"===e)}self.addEventListener("install",e=>{console.log("[SW] Installing..."),e.waitUntil(caches.open("orbit-v2").then(e=>(console.log("[SW] Caching static assets"),e.addAll(STATIC_ASSETS))).then(()=>self.skipWaiting()))}),self.addEventListener("activate",e=>{console.log("[SW] Activating..."),e.waitUntil(caches.keys().then(e=>Promise.all(e.filter(e=>"orbit-v2"!==e).map(e=>(console.log("[SW] Deleting old cache:",e),caches.delete(e))))).then(()=>self.clients.claim()))}),self.addEventListener("fetch",e=>{const{request:t}=e,n=new URL(t.url);"GET"===t.method&&n.protocol.startsWith("http")&&(isStaticAsset(n.pathname)?e.respondWith(cacheFirst(t)):e.respondWith(staleWhileRevalidate(t)))}),self.addEventListener("sync",e=>{"sync-items"===e.tag&&console.log("[SW] Background sync triggered")}),self.addEventListener("push",e=>{const t=e.data?.json()||{};console.log("[SW] Push received:",t);const n={body:t.body||"You have items needing attention",icon:"/favicon.ico",badge:"/favicon.ico",tag:"orbit-notification",renotify:!0};e.waitUntil(self.registration.showNotification(t.title||"Orbit",n))}),self.addEventListener("notificationclick",e=>{e.notification.close(),e.waitUntil(clients.matchAll({type:"window"}).then(e=>{for(const t of e)if(t.url.includes(self.location.origin)&&"focus"in t)return t.focus();if(clients.openWindow)return clients.openWindow("/")}))}),console.log("[SW] Service worker loaded");